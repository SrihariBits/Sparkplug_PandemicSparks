{"ast":null,"code":"import React from 'react';\nimport PropTypes from 'prop-types';\nimport { ReactSVGPanZoom, TOOL_NONE, TOOL_PAN, TOOL_ZOOM_IN, TOOL_ZOOM_OUT, TOOL_AUTO } from 'react-svg-pan-zoom';\nimport * as constants from '../../constants';\nimport State from './state';\nimport * as SharedStyle from '../../shared-style';\nimport { RulerX, RulerY } from './export';\n\nfunction mode2Tool(mode) {\n  switch (mode) {\n    case constants.MODE_2D_PAN:\n      return TOOL_PAN;\n\n    case constants.MODE_2D_ZOOM_IN:\n      return TOOL_ZOOM_IN;\n\n    case constants.MODE_2D_ZOOM_OUT:\n      return TOOL_ZOOM_OUT;\n\n    case constants.MODE_IDLE:\n      return TOOL_AUTO;\n\n    default:\n      return TOOL_NONE;\n  }\n}\n\nfunction mode2PointerEvents(mode) {\n  switch (mode) {\n    case constants.MODE_DRAWING_LINE:\n    case constants.MODE_DRAWING_HOLE:\n    case constants.MODE_DRAWING_ITEM:\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_ITEM:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n      return {\n        pointerEvents: 'none'\n      };\n\n    default:\n      return {};\n  }\n}\n\nfunction mode2Cursor(mode) {\n  switch (mode) {\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n    case constants.MODE_DRAGGING_ITEM:\n      return {\n        cursor: 'move'\n      };\n\n    case constants.MODE_ROTATING_ITEM:\n      return {\n        cursor: 'ew-resize'\n      };\n\n    case constants.MODE_WAITING_DRAWING_LINE:\n    case constants.MODE_DRAWING_LINE:\n      return {\n        cursor: 'crosshair'\n      };\n\n    default:\n      return {\n        cursor: 'default'\n      };\n  }\n}\n\nfunction mode2DetectAutopan(mode) {\n  switch (mode) {\n    case constants.MODE_DRAWING_LINE:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_ITEM:\n    case constants.MODE_DRAWING_HOLE:\n    case constants.MODE_DRAWING_ITEM:\n      return true;\n\n    default:\n      return false;\n  }\n}\n\nfunction extractElementData(node) {\n  while (!node.attributes.getNamedItem('data-element-root') && node.tagName !== 'svg') {\n    node = node.parentNode;\n  }\n\n  if (node.tagName === 'svg') return null;\n  return {\n    part: node.attributes.getNamedItem('data-part') ? node.attributes.getNamedItem('data-part').value : undefined,\n    layer: node.attributes.getNamedItem('data-layer').value,\n    prototype: node.attributes.getNamedItem('data-prototype').value,\n    selected: node.attributes.getNamedItem('data-selected').value === 'true',\n    id: node.attributes.getNamedItem('data-id').value\n  };\n}\n\nexport default function Viewer2D(_ref, _ref2) {\n  var state = _ref.state,\n      width = _ref.width,\n      height = _ref.height;\n  var viewer2DActions = _ref2.viewer2DActions,\n      linesActions = _ref2.linesActions,\n      holesActions = _ref2.holesActions,\n      verticesActions = _ref2.verticesActions,\n      itemsActions = _ref2.itemsActions,\n      areaActions = _ref2.areaActions,\n      projectActions = _ref2.projectActions,\n      catalog = _ref2.catalog;\n  var viewer2D = state.viewer2D,\n      mode = state.mode,\n      scene = state.scene;\n  var layerID = scene.selectedLayer;\n\n  var mapCursorPosition = function mapCursorPosition(_ref3) {\n    var x = _ref3.x,\n        y = _ref3.y;\n    return {\n      x: x,\n      y: -y + scene.height\n    };\n  };\n\n  var onMouseMove = function onMouseMove(viewerEvent) {\n    //workaround that allow imageful component to work\n    var evt = new Event('mousemove-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition.x,\n        y = _mapCursorPosition.y;\n\n    projectActions.updateMouseCoord({\n      x: x,\n      y: y\n    });\n\n    switch (mode) {\n      case constants.MODE_DRAWING_LINE:\n        linesActions.updateDrawingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_HOLE:\n        holesActions.updateDrawingHole(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAWING_ITEM:\n        itemsActions.updateDrawingItem(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAGGING_HOLE:\n        holesActions.updateDraggingHole(x, y);\n        break;\n\n      case constants.MODE_DRAGGING_LINE:\n        linesActions.updateDraggingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_VERTEX:\n        verticesActions.updateDraggingVertex(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_ITEM:\n        itemsActions.updateDraggingItem(x, y);\n        break;\n\n      case constants.MODE_ROTATING_ITEM:\n        itemsActions.updateRotatingItem(x, y);\n        break;\n    }\n\n    viewerEvent.originalEvent.stopPropagation();\n  };\n\n  var onMouseDown = function onMouseDown(viewerEvent) {\n    var event = viewerEvent.originalEvent; //workaround that allow imageful component to work\n\n    var evt = new Event('mousedown-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition2 = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition2.x,\n        y = _mapCursorPosition2.y;\n\n    if (mode === constants.MODE_IDLE) {\n      var elementData = extractElementData(event.target);\n      if (!elementData || !elementData.selected) return;\n\n      switch (elementData.prototype) {\n        case 'lines':\n          linesActions.beginDraggingLine(elementData.layer, elementData.id, x, y, state.snapMask);\n          break;\n\n        case 'vertices':\n          verticesActions.beginDraggingVertex(elementData.layer, elementData.id, x, y, state.snapMask);\n          break;\n\n        case 'items':\n          if (elementData.part === 'rotation-anchor') itemsActions.beginRotatingItem(elementData.layer, elementData.id, x, y);else itemsActions.beginDraggingItem(elementData.layer, elementData.id, x, y);\n          break;\n\n        case 'holes':\n          holesActions.beginDraggingHole(elementData.layer, elementData.id, x, y);\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    event.stopPropagation();\n  };\n\n  var onMouseUp = function onMouseUp(viewerEvent) {\n    var event = viewerEvent.originalEvent;\n    var evt = new Event('mouseup-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition3 = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition3.x,\n        y = _mapCursorPosition3.y;\n\n    switch (mode) {\n      case constants.MODE_IDLE:\n        var elementData = extractElementData(event.target);\n        if (elementData && elementData.selected) return;\n\n        switch (elementData ? elementData.prototype : 'none') {\n          case 'areas':\n            areaActions.selectArea(elementData.layer, elementData.id);\n            break;\n\n          case 'lines':\n            linesActions.selectLine(elementData.layer, elementData.id);\n            break;\n\n          case 'holes':\n            holesActions.selectHole(elementData.layer, elementData.id);\n            break;\n\n          case 'items':\n            itemsActions.selectItem(elementData.layer, elementData.id);\n            break;\n\n          case 'none':\n            projectActions.unselectAll();\n            break;\n        }\n\n        break;\n\n      case constants.MODE_WAITING_DRAWING_LINE:\n        linesActions.beginDrawingLine(layerID, x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_LINE:\n        linesActions.endDrawingLine(x, y, state.snapMask);\n        linesActions.beginDrawingLine(layerID, x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_HOLE:\n        holesActions.endDrawingHole(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAWING_ITEM:\n        itemsActions.endDrawingItem(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAGGING_LINE:\n        linesActions.endDraggingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_VERTEX:\n        verticesActions.endDraggingVertex(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_ITEM:\n        itemsActions.endDraggingItem(x, y);\n        break;\n\n      case constants.MODE_DRAGGING_HOLE:\n        holesActions.endDraggingHole(x, y);\n        break;\n\n      case constants.MODE_ROTATING_ITEM:\n        itemsActions.endRotatingItem(x, y);\n        break;\n    }\n\n    event.stopPropagation();\n  };\n\n  var onChangeValue = function onChangeValue(value) {\n    projectActions.updateZoomScale(value.a);\n    return viewer2DActions.updateCameraView(value);\n  };\n\n  var onChangeTool = function onChangeTool(tool) {\n    switch (tool) {\n      case TOOL_NONE:\n        projectActions.selectToolEdit();\n        break;\n\n      case TOOL_PAN:\n        viewer2DActions.selectToolPan();\n        break;\n\n      case TOOL_ZOOM_IN:\n        viewer2DActions.selectToolZoomIn();\n        break;\n\n      case TOOL_ZOOM_OUT:\n        viewer2DActions.selectToolZoomOut();\n        break;\n    }\n  };\n\n  var _state$get$toJS = state.get('viewer2D').toJS(),\n      e = _state$get$toJS.e,\n      f = _state$get$toJS.f,\n      SVGWidth = _state$get$toJS.SVGWidth,\n      SVGHeight = _state$get$toJS.SVGHeight;\n\n  var rulerSize = 15; //px\n\n  var rulerUnitPixelSize = 100;\n  var rulerBgColor = SharedStyle.PRIMARY_COLOR.main;\n  var rulerFnColor = SharedStyle.COLORS.white;\n  var rulerMkColor = SharedStyle.SECONDARY_COLOR.main;\n  var sceneWidth = SVGWidth || state.getIn(['scene', 'width']);\n  var sceneHeight = SVGHeight || state.getIn(['scene', 'height']);\n  var sceneZoom = state.zoom || 1;\n  var rulerXElements = Math.ceil(sceneWidth / rulerUnitPixelSize) + 1;\n  var rulerYElements = Math.ceil(sceneHeight / rulerUnitPixelSize) + 1;\n  return React.createElement('div', {\n    style: {\n      margin: 0,\n      padding: 0,\n      display: 'grid',\n      gridRowGap: '0',\n      gridColumnGap: '0',\n      gridTemplateColumns: rulerSize + 'px ' + (width - rulerSize) + 'px',\n      gridTemplateRows: rulerSize + 'px ' + (height - rulerSize) + 'px',\n      position: 'relative'\n    }\n  }, React.createElement('div', {\n    style: {\n      gridColumn: 1,\n      gridRow: 1,\n      backgroundColor: rulerBgColor\n    }\n  }), React.createElement('div', {\n    style: {\n      gridRow: 1,\n      gridColumn: 2,\n      position: 'relative',\n      overflow: 'hidden'\n    },\n    id: 'rulerX'\n  }, sceneWidth ? React.createElement(RulerX, {\n    unitPixelSize: rulerUnitPixelSize,\n    zoom: sceneZoom,\n    mouseX: state.mouse.get('x'),\n    width: width - rulerSize,\n    zeroLeftPosition: e || 0,\n    backgroundColor: rulerBgColor,\n    fontColor: rulerFnColor,\n    markerColor: rulerMkColor,\n    positiveUnitsNumber: rulerXElements,\n    negativeUnitsNumber: 0\n  }) : null), React.createElement('div', {\n    style: {\n      gridColumn: 1,\n      gridRow: 2,\n      position: 'relative',\n      overflow: 'hidden'\n    },\n    id: 'rulerY'\n  }, sceneHeight ? React.createElement(RulerY, {\n    unitPixelSize: rulerUnitPixelSize,\n    zoom: sceneZoom,\n    mouseY: state.mouse.get('y'),\n    height: height - rulerSize,\n    zeroTopPosition: sceneHeight * sceneZoom + f || 0,\n    backgroundColor: rulerBgColor,\n    fontColor: rulerFnColor,\n    markerColor: rulerMkColor,\n    positiveUnitsNumber: rulerYElements,\n    negativeUnitsNumber: 0\n  }) : null), React.createElement(ReactSVGPanZoom, {\n    style: {\n      gridColumn: 2,\n      gridRow: 2\n    },\n    width: width - rulerSize,\n    height: height - rulerSize,\n    value: viewer2D.isEmpty() ? null : viewer2D.toJS(),\n    onChangeValue: onChangeValue,\n    tool: mode2Tool(mode),\n    onChangeTool: onChangeTool,\n    detectAutoPan: mode2DetectAutopan(mode),\n    onMouseDown: onMouseDown,\n    onMouseMove: onMouseMove,\n    onMouseUp: onMouseUp,\n    miniaturePosition: 'none',\n    toolbarPosition: 'none'\n  }, React.createElement('svg', {\n    width: scene.width,\n    height: scene.height\n  }, React.createElement('defs', null, React.createElement('pattern', {\n    id: 'diagonalFill',\n    patternUnits: 'userSpaceOnUse',\n    width: '4',\n    height: '4',\n    fill: '#FFF'\n  }, React.createElement('rect', {\n    x: '0',\n    y: '0',\n    width: '4',\n    height: '4',\n    fill: '#FFF'\n  }), React.createElement('path', {\n    d: 'M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2',\n    style: {\n      stroke: '#8E9BA2',\n      strokeWidth: 1\n    }\n  }))), React.createElement('g', {\n    style: Object.assign(mode2Cursor(mode), mode2PointerEvents(mode))\n  }, React.createElement(State, {\n    state: state,\n    catalog: catalog\n  })))));\n}\nViewer2D.propTypes = {\n  state: PropTypes.object.isRequired,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired\n};\nViewer2D.contextTypes = {\n  viewer2DActions: PropTypes.object.isRequired,\n  linesActions: PropTypes.object.isRequired,\n  holesActions: PropTypes.object.isRequired,\n  verticesActions: PropTypes.object.isRequired,\n  itemsActions: PropTypes.object.isRequired,\n  areaActions: PropTypes.object.isRequired,\n  projectActions: PropTypes.object.isRequired,\n  catalog: PropTypes.object.isRequired\n};","map":{"version":3,"sources":["/home/srihari/Desktop/Sparkplug_PandemicSparks/grid/node_modules/react-planner/es/components/viewer2d/viewer2d.js"],"names":["React","PropTypes","ReactSVGPanZoom","TOOL_NONE","TOOL_PAN","TOOL_ZOOM_IN","TOOL_ZOOM_OUT","TOOL_AUTO","constants","State","SharedStyle","RulerX","RulerY","mode2Tool","mode","MODE_2D_PAN","MODE_2D_ZOOM_IN","MODE_2D_ZOOM_OUT","MODE_IDLE","mode2PointerEvents","MODE_DRAWING_LINE","MODE_DRAWING_HOLE","MODE_DRAWING_ITEM","MODE_DRAGGING_HOLE","MODE_DRAGGING_ITEM","MODE_DRAGGING_LINE","MODE_DRAGGING_VERTEX","pointerEvents","mode2Cursor","cursor","MODE_ROTATING_ITEM","MODE_WAITING_DRAWING_LINE","mode2DetectAutopan","extractElementData","node","attributes","getNamedItem","tagName","parentNode","part","value","undefined","layer","prototype","selected","id","Viewer2D","_ref","_ref2","state","width","height","viewer2DActions","linesActions","holesActions","verticesActions","itemsActions","areaActions","projectActions","catalog","viewer2D","scene","layerID","selectedLayer","mapCursorPosition","_ref3","x","y","onMouseMove","viewerEvent","evt","Event","document","dispatchEvent","_mapCursorPosition","updateMouseCoord","updateDrawingLine","snapMask","updateDrawingHole","updateDrawingItem","updateDraggingHole","updateDraggingLine","updateDraggingVertex","updateDraggingItem","updateRotatingItem","originalEvent","stopPropagation","onMouseDown","event","_mapCursorPosition2","elementData","target","beginDraggingLine","beginDraggingVertex","beginRotatingItem","beginDraggingItem","beginDraggingHole","onMouseUp","_mapCursorPosition3","selectArea","selectLine","selectHole","selectItem","unselectAll","beginDrawingLine","endDrawingLine","endDrawingHole","endDrawingItem","endDraggingLine","endDraggingVertex","endDraggingItem","endDraggingHole","endRotatingItem","onChangeValue","updateZoomScale","a","updateCameraView","onChangeTool","tool","selectToolEdit","selectToolPan","selectToolZoomIn","selectToolZoomOut","_state$get$toJS","get","toJS","e","f","SVGWidth","SVGHeight","rulerSize","rulerUnitPixelSize","rulerBgColor","PRIMARY_COLOR","main","rulerFnColor","COLORS","white","rulerMkColor","SECONDARY_COLOR","sceneWidth","getIn","sceneHeight","sceneZoom","zoom","rulerXElements","Math","ceil","rulerYElements","createElement","style","margin","padding","display","gridRowGap","gridColumnGap","gridTemplateColumns","gridTemplateRows","position","gridColumn","gridRow","backgroundColor","overflow","unitPixelSize","mouseX","mouse","zeroLeftPosition","fontColor","markerColor","positiveUnitsNumber","negativeUnitsNumber","mouseY","zeroTopPosition","isEmpty","detectAutoPan","miniaturePosition","toolbarPosition","patternUnits","fill","d","stroke","strokeWidth","Object","assign","propTypes","object","isRequired","number","contextTypes"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { ReactSVGPanZoom, TOOL_NONE, TOOL_PAN, TOOL_ZOOM_IN, TOOL_ZOOM_OUT, TOOL_AUTO } from 'react-svg-pan-zoom';\nimport * as constants from '../../constants';\nimport State from './state';\nimport * as SharedStyle from '../../shared-style';\nimport { RulerX, RulerY } from './export';\n\nfunction mode2Tool(mode) {\n  switch (mode) {\n    case constants.MODE_2D_PAN:\n      return TOOL_PAN;\n    case constants.MODE_2D_ZOOM_IN:\n      return TOOL_ZOOM_IN;\n    case constants.MODE_2D_ZOOM_OUT:\n      return TOOL_ZOOM_OUT;\n    case constants.MODE_IDLE:\n      return TOOL_AUTO;\n    default:\n      return TOOL_NONE;\n  }\n}\n\nfunction mode2PointerEvents(mode) {\n  switch (mode) {\n    case constants.MODE_DRAWING_LINE:\n    case constants.MODE_DRAWING_HOLE:\n    case constants.MODE_DRAWING_ITEM:\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_ITEM:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n      return { pointerEvents: 'none' };\n\n    default:\n      return {};\n  }\n}\n\nfunction mode2Cursor(mode) {\n  switch (mode) {\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n    case constants.MODE_DRAGGING_ITEM:\n      return { cursor: 'move' };\n\n    case constants.MODE_ROTATING_ITEM:\n      return { cursor: 'ew-resize' };\n\n    case constants.MODE_WAITING_DRAWING_LINE:\n    case constants.MODE_DRAWING_LINE:\n      return { cursor: 'crosshair' };\n    default:\n      return { cursor: 'default' };\n  }\n}\n\nfunction mode2DetectAutopan(mode) {\n  switch (mode) {\n    case constants.MODE_DRAWING_LINE:\n    case constants.MODE_DRAGGING_LINE:\n    case constants.MODE_DRAGGING_VERTEX:\n    case constants.MODE_DRAGGING_HOLE:\n    case constants.MODE_DRAGGING_ITEM:\n    case constants.MODE_DRAWING_HOLE:\n    case constants.MODE_DRAWING_ITEM:\n      return true;\n\n    default:\n      return false;\n  }\n}\n\nfunction extractElementData(node) {\n  while (!node.attributes.getNamedItem('data-element-root') && node.tagName !== 'svg') {\n    node = node.parentNode;\n  }\n  if (node.tagName === 'svg') return null;\n\n  return {\n    part: node.attributes.getNamedItem('data-part') ? node.attributes.getNamedItem('data-part').value : undefined,\n    layer: node.attributes.getNamedItem('data-layer').value,\n    prototype: node.attributes.getNamedItem('data-prototype').value,\n    selected: node.attributes.getNamedItem('data-selected').value === 'true',\n    id: node.attributes.getNamedItem('data-id').value\n  };\n}\n\nexport default function Viewer2D(_ref, _ref2) {\n  var state = _ref.state,\n      width = _ref.width,\n      height = _ref.height;\n  var viewer2DActions = _ref2.viewer2DActions,\n      linesActions = _ref2.linesActions,\n      holesActions = _ref2.holesActions,\n      verticesActions = _ref2.verticesActions,\n      itemsActions = _ref2.itemsActions,\n      areaActions = _ref2.areaActions,\n      projectActions = _ref2.projectActions,\n      catalog = _ref2.catalog;\n  var viewer2D = state.viewer2D,\n      mode = state.mode,\n      scene = state.scene;\n\n\n  var layerID = scene.selectedLayer;\n\n  var mapCursorPosition = function mapCursorPosition(_ref3) {\n    var x = _ref3.x,\n        y = _ref3.y;\n\n    return { x: x, y: -y + scene.height };\n  };\n\n  var onMouseMove = function onMouseMove(viewerEvent) {\n\n    //workaround that allow imageful component to work\n    var evt = new Event('mousemove-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition.x,\n        y = _mapCursorPosition.y;\n\n    projectActions.updateMouseCoord({ x: x, y: y });\n\n    switch (mode) {\n      case constants.MODE_DRAWING_LINE:\n        linesActions.updateDrawingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_HOLE:\n        holesActions.updateDrawingHole(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAWING_ITEM:\n        itemsActions.updateDrawingItem(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAGGING_HOLE:\n        holesActions.updateDraggingHole(x, y);\n        break;\n\n      case constants.MODE_DRAGGING_LINE:\n        linesActions.updateDraggingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_VERTEX:\n        verticesActions.updateDraggingVertex(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_ITEM:\n        itemsActions.updateDraggingItem(x, y);\n        break;\n\n      case constants.MODE_ROTATING_ITEM:\n        itemsActions.updateRotatingItem(x, y);\n        break;\n    }\n\n    viewerEvent.originalEvent.stopPropagation();\n  };\n\n  var onMouseDown = function onMouseDown(viewerEvent) {\n    var event = viewerEvent.originalEvent;\n\n    //workaround that allow imageful component to work\n    var evt = new Event('mousedown-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition2 = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition2.x,\n        y = _mapCursorPosition2.y;\n\n    if (mode === constants.MODE_IDLE) {\n      var elementData = extractElementData(event.target);\n      if (!elementData || !elementData.selected) return;\n\n      switch (elementData.prototype) {\n        case 'lines':\n          linesActions.beginDraggingLine(elementData.layer, elementData.id, x, y, state.snapMask);\n          break;\n\n        case 'vertices':\n          verticesActions.beginDraggingVertex(elementData.layer, elementData.id, x, y, state.snapMask);\n          break;\n\n        case 'items':\n          if (elementData.part === 'rotation-anchor') itemsActions.beginRotatingItem(elementData.layer, elementData.id, x, y);else itemsActions.beginDraggingItem(elementData.layer, elementData.id, x, y);\n          break;\n\n        case 'holes':\n          holesActions.beginDraggingHole(elementData.layer, elementData.id, x, y);\n          break;\n\n        default:\n          break;\n      }\n    }\n    event.stopPropagation();\n  };\n\n  var onMouseUp = function onMouseUp(viewerEvent) {\n    var event = viewerEvent.originalEvent;\n\n    var evt = new Event('mouseup-planner-event');\n    evt.viewerEvent = viewerEvent;\n    document.dispatchEvent(evt);\n\n    var _mapCursorPosition3 = mapCursorPosition(viewerEvent),\n        x = _mapCursorPosition3.x,\n        y = _mapCursorPosition3.y;\n\n    switch (mode) {\n\n      case constants.MODE_IDLE:\n        var elementData = extractElementData(event.target);\n\n        if (elementData && elementData.selected) return;\n\n        switch (elementData ? elementData.prototype : 'none') {\n          case 'areas':\n            areaActions.selectArea(elementData.layer, elementData.id);\n            break;\n\n          case 'lines':\n            linesActions.selectLine(elementData.layer, elementData.id);\n            break;\n\n          case 'holes':\n            holesActions.selectHole(elementData.layer, elementData.id);\n            break;\n\n          case 'items':\n            itemsActions.selectItem(elementData.layer, elementData.id);\n            break;\n\n          case 'none':\n            projectActions.unselectAll();\n            break;\n        }\n        break;\n\n      case constants.MODE_WAITING_DRAWING_LINE:\n        linesActions.beginDrawingLine(layerID, x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_LINE:\n        linesActions.endDrawingLine(x, y, state.snapMask);\n        linesActions.beginDrawingLine(layerID, x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAWING_HOLE:\n        holesActions.endDrawingHole(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAWING_ITEM:\n        itemsActions.endDrawingItem(layerID, x, y);\n        break;\n\n      case constants.MODE_DRAGGING_LINE:\n        linesActions.endDraggingLine(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_VERTEX:\n        verticesActions.endDraggingVertex(x, y, state.snapMask);\n        break;\n\n      case constants.MODE_DRAGGING_ITEM:\n        itemsActions.endDraggingItem(x, y);\n        break;\n\n      case constants.MODE_DRAGGING_HOLE:\n        holesActions.endDraggingHole(x, y);\n        break;\n\n      case constants.MODE_ROTATING_ITEM:\n        itemsActions.endRotatingItem(x, y);\n        break;\n    }\n\n    event.stopPropagation();\n  };\n\n  var onChangeValue = function onChangeValue(value) {\n    projectActions.updateZoomScale(value.a);\n    return viewer2DActions.updateCameraView(value);\n  };\n\n  var onChangeTool = function onChangeTool(tool) {\n    switch (tool) {\n      case TOOL_NONE:\n        projectActions.selectToolEdit();\n        break;\n\n      case TOOL_PAN:\n        viewer2DActions.selectToolPan();\n        break;\n\n      case TOOL_ZOOM_IN:\n        viewer2DActions.selectToolZoomIn();\n        break;\n\n      case TOOL_ZOOM_OUT:\n        viewer2DActions.selectToolZoomOut();\n        break;\n    }\n  };\n\n  var _state$get$toJS = state.get('viewer2D').toJS(),\n      e = _state$get$toJS.e,\n      f = _state$get$toJS.f,\n      SVGWidth = _state$get$toJS.SVGWidth,\n      SVGHeight = _state$get$toJS.SVGHeight;\n\n  var rulerSize = 15; //px\n  var rulerUnitPixelSize = 100;\n  var rulerBgColor = SharedStyle.PRIMARY_COLOR.main;\n  var rulerFnColor = SharedStyle.COLORS.white;\n  var rulerMkColor = SharedStyle.SECONDARY_COLOR.main;\n  var sceneWidth = SVGWidth || state.getIn(['scene', 'width']);\n  var sceneHeight = SVGHeight || state.getIn(['scene', 'height']);\n  var sceneZoom = state.zoom || 1;\n  var rulerXElements = Math.ceil(sceneWidth / rulerUnitPixelSize) + 1;\n  var rulerYElements = Math.ceil(sceneHeight / rulerUnitPixelSize) + 1;\n\n  return React.createElement(\n    'div',\n    { style: {\n        margin: 0,\n        padding: 0,\n        display: 'grid',\n        gridRowGap: '0',\n        gridColumnGap: '0',\n        gridTemplateColumns: rulerSize + 'px ' + (width - rulerSize) + 'px',\n        gridTemplateRows: rulerSize + 'px ' + (height - rulerSize) + 'px',\n        position: 'relative'\n      } },\n    React.createElement('div', { style: { gridColumn: 1, gridRow: 1, backgroundColor: rulerBgColor } }),\n    React.createElement(\n      'div',\n      { style: { gridRow: 1, gridColumn: 2, position: 'relative', overflow: 'hidden' }, id: 'rulerX' },\n      sceneWidth ? React.createElement(RulerX, {\n        unitPixelSize: rulerUnitPixelSize,\n        zoom: sceneZoom,\n        mouseX: state.mouse.get('x'),\n        width: width - rulerSize,\n        zeroLeftPosition: e || 0,\n        backgroundColor: rulerBgColor,\n        fontColor: rulerFnColor,\n        markerColor: rulerMkColor,\n        positiveUnitsNumber: rulerXElements,\n        negativeUnitsNumber: 0\n      }) : null\n    ),\n    React.createElement(\n      'div',\n      { style: { gridColumn: 1, gridRow: 2, position: 'relative', overflow: 'hidden' }, id: 'rulerY' },\n      sceneHeight ? React.createElement(RulerY, {\n        unitPixelSize: rulerUnitPixelSize,\n        zoom: sceneZoom,\n        mouseY: state.mouse.get('y'),\n        height: height - rulerSize,\n        zeroTopPosition: sceneHeight * sceneZoom + f || 0,\n        backgroundColor: rulerBgColor,\n        fontColor: rulerFnColor,\n        markerColor: rulerMkColor,\n        positiveUnitsNumber: rulerYElements,\n        negativeUnitsNumber: 0\n      }) : null\n    ),\n    React.createElement(\n      ReactSVGPanZoom,\n      {\n        style: { gridColumn: 2, gridRow: 2 },\n        width: width - rulerSize,\n        height: height - rulerSize,\n        value: viewer2D.isEmpty() ? null : viewer2D.toJS(),\n        onChangeValue: onChangeValue,\n        tool: mode2Tool(mode),\n        onChangeTool: onChangeTool,\n        detectAutoPan: mode2DetectAutopan(mode),\n        onMouseDown: onMouseDown,\n        onMouseMove: onMouseMove,\n        onMouseUp: onMouseUp,\n        miniaturePosition: 'none',\n        toolbarPosition: 'none'\n      },\n      React.createElement(\n        'svg',\n        { width: scene.width, height: scene.height },\n        React.createElement(\n          'defs',\n          null,\n          React.createElement(\n            'pattern',\n            { id: 'diagonalFill', patternUnits: 'userSpaceOnUse', width: '4', height: '4', fill: '#FFF' },\n            React.createElement('rect', { x: '0', y: '0', width: '4', height: '4', fill: '#FFF' }),\n            React.createElement('path', { d: 'M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2', style: { stroke: '#8E9BA2', strokeWidth: 1 } })\n          )\n        ),\n        React.createElement(\n          'g',\n          { style: Object.assign(mode2Cursor(mode), mode2PointerEvents(mode)) },\n          React.createElement(State, { state: state, catalog: catalog })\n        )\n      )\n    )\n  );\n}\n\nViewer2D.propTypes = {\n  state: PropTypes.object.isRequired,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired\n};\n\nViewer2D.contextTypes = {\n  viewer2DActions: PropTypes.object.isRequired,\n  linesActions: PropTypes.object.isRequired,\n  holesActions: PropTypes.object.isRequired,\n  verticesActions: PropTypes.object.isRequired,\n  itemsActions: PropTypes.object.isRequired,\n  areaActions: PropTypes.object.isRequired,\n  projectActions: PropTypes.object.isRequired,\n  catalog: PropTypes.object.isRequired\n};"]},"metadata":{},"sourceType":"module"}